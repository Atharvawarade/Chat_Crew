<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Assistance Chatbot</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script
      src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
      type="module"
    ></script>
  </head>

  <body>
    <header>
      <div class="header-content">
        <div class="logo">Technical Education Department</div>
        <nav>
          <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#about">About Us</a></li>
            <li><a href="#courses">Admissions</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <section class="hero" id="home">
      <h1>Welcome to the Department of Technical Education</h1>
      <p>Empowering Education for a Better Future</p>
    </section>

    <section class="profile-section">
      <div class="card">
        <img
          src="/static/images/WhatsApp%20Image%202024-12-12%20at%2010.02.11_bb0889a5.jpg"
          alt="Chief Minister"
        />
        <h3>Chief Minister</h3>
        <p>Shri Bhajan Lal Sharma</p>
      </div>
      <div class="card">
        <img
          src="/static/images/WhatsApp%20Image%202024-12-12%20at%2010.09.52_fa3ae80c.jpg"
          alt="Deputy Minister"
        />
        <h3>Deputy Minister</h3>
        <p>Dr. Prem Chand Bairwa</p>
      </div>
      <div class="card">
        <img
          src="/static/images/WhatsApp%20Image%202024-12-12%20at%2010.02.10_2e90b542.jpg"
          alt="Secretary"
        />
        <h3>Secretary</h3>
        <p>Dr. Arushi Ajey Malik</p>
      </div>
      <div class="card">
        <img
          src="/static/images/WhatsApp%20Image%202024-12-12%20at%2010.02.11_494b5f79.jpg"
          alt="Director"
        />
        <h3>Director</h3>
        <p>Shri Anshu Kumar Sahgal</p>
      </div>
    </section>

    <footer>
      <p>&copy; 2024 Department of Technical Education. All rights reserved.</p>
      <p>
        Contact:
        <a href="mailto:dte_raj@rajasthan.gov.in">dte_raj@rajasthan.gov.in</a> |
        Phone: 0291-2434395
      </p>
    </footer>

    <!-- Chatbot Container -->
    <div id="chatbot" class="chatbot-container">
      <div class="chatbot-header">
        <span class="chatbot-title">Student Assistance Chatbot</span>
        <button
          class="btn-close btn-close-white"
          onclick="toggleChatbot()"
          aria-label="Close"
        ></button>
      </div>

      <!-- Initial Screen -->
      <div id="initialScreen" class="initial-screen text-center">
        <dotlottie-player
          src="https://lottie.host/6ae13108-19a6-46fe-8e3d-beb8c9b99fc4/zoP2jLUfSB.lottie"
          class="lottie-animation"
          background="transparent"
          speed="1"
          style="width: 300px; height: 200px"
          loop
          autoplay
        ></dotlottie-player>
        <p class="welcome-text">
          Welcome!! I am your virtual assistant, here to help you navigate the
          admission process and answer all your queries about engineering and
          polytechnic institutes in Rajasthan.
        </p>

        <div class="mt-3">
          <select id="languageSelector" class="form-select w-50 mx-auto">
            <option value="en" selected>Select Language</option>
            <option value="es">English</option>
            <option value="fr">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
            <option value="de">Rajasthani</option>
          </select>
        </div>

        <br />
        <button class="cta" onclick="startChat()">
          <span>Start Chat</span>
          <svg width="15px" height="10px" viewBox="0 0 13 10">
            <path d="M1,5 L11,5"></path>
            <polyline points="8 1 12 5 8 9"></polyline>
          </svg>
        </button>
      </div>

      <!-- Chatbot Body (Initially Hidden) -->
      <div id="chatBody" class="chatbot-body d-none">
        <div class="chat-message bot-message">
          Hello! üëã<br />How can I assist you?
        </div>
      </div>

      <!-- Chatbot Footer (Initially Hidden) -->
      <div id="chatFooter" class="chatbot-footer d-none">
        <button class="icon-button" onclick="activateMicrophone()">
          <img src="/static/images/microphone.png" alt="Mic" />
        </button>
        <button class="icon-button">
          <img src="/static/images/attach-file.png" alt="Attach" />
        </button>
        <input
          id="userMessage"
          type="text"
          class="form-control"
          placeholder="Ask your query"
        />
        <button class="icon-button send-button" onclick="sendMessage()">
          <i
            class="fa fa-send-o"
            style="font-size: 25px; color: rgb(255, 255, 255)"
          ></i>
        </button>
      </div>
    </div>

    <!-- Chatbot Toggle Button -->
    <button class="chatbot-toggle" onclick="toggleChatbot()">
      <img src="/static/images/Chatbot%20Icon.png" alt="Chatbot Toggle" />
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function toggleChatbot() {
        const chatbot = document.getElementById("chatbot");
        chatbot.classList.toggle("active");
      }

      function startChat() {
        document.getElementById("initialScreen").classList.add("d-none");
        document.getElementById("chatBody").classList.remove("d-none");
        document.getElementById("chatFooter").classList.remove("d-none");
      }

      async function sendMessage() {
        const userMessage = document.getElementById("userMessage").value.trim();
        const chatBody = document.getElementById("chatBody");
        if (userMessage === "") return;

        chatBody.innerHTML += `<div class="chat-message user-message">${userMessage}</div>`;
        document.getElementById("userMessage").value = "";
        chatBody.scrollTop = chatBody.scrollHeight;

        chatBody.innerHTML += `<div class="chat-message bot-message thinking">
        <span class="loader"></span>
        </div>`;
        chatBody.scrollTop = chatBody.scrollHeight;

        try {
          const response = await fetch("/query", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question: userMessage }),
          });
          const data = await response.json();

          document.querySelector(".thinking").remove();
          chatBody.innerHTML += `<div class="chat-message bot-message">${data.response}</div>`;
          chatBody.scrollTop = chatBody.scrollHeight;
        } catch (error) {
          document.querySelector(".thinking").remove();
          chatBody.innerHTML += `<div class="chat-message bot-message">Error processing your request.</div>`;
          chatBody.scrollTop = chatBody.scrollHeight;
        }
      }

      async function activateMicrophone() {
        const chatBody = document.getElementById("chatBody");
        const userMessageInput = document.getElementById("userMessage");

        // Display a "Listening..." message
        chatBody.innerHTML += `<div class="chat-message bot-message">Listening...</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;

        try {
          // Call the voice-input API
          const response = await fetch("/voice-input", { method: "POST" });
          const data = await response.json();

          // Remove "Listening..." message
          document.querySelector(".bot-message:last-child").remove();

          if (data.success) {
            // Populate the recognized text into the input box
            userMessageInput.value = data.text;

            // Automatically fire the query
            sendMessage();
          } else {
            // Display the error message
            chatBody.innerHTML += `<div class="chat-message bot-message">${data.message}</div>`;
            chatBody.scrollTop = chatBody.scrollHeight;
          }
        } catch (error) {
          console.error("Error activating microphone:", error);
          document.querySelector(".bot-message:last-child").remove();
          chatBody.innerHTML += `<div class="chat-message bot-message">Error activating microphone.</div>`;
          chatBody.scrollTop = chatBody.scrollHeight;
        }
      }

      document
        .getElementById("userMessage")
        .addEventListener("keypress", function (event) {
          if (event.key === "Enter") {
            event.preventDefault();
            sendMessage();
          }
        });
    </script>
  </body>
</html>
